<!-- Name: CP Jiang / Student ID: 1148594 -->
<!-- Use Bootstrap nav class to give the nav bar a modern view -->
<!-- Added a project page for role mentor -->

{% extends "staff/staffbase.html" %}
{% block content %}
    <script src="https://cdn.staticfile.org/echarts/4.3.0/echarts.min.js"></script>
    <body>
    <div id="container" style="width:100%">

        <div id="header" style="background-color:#FFA500;height: 100px;width:100%">
            <h1>Dashboard </h1></div>
        <div >
                 <button style="margin-left: 300px;margin-top: 100px" class="btn btn-primary" onclick="processMatching()">Process Matchs</button>
        </div>
        <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
        <div style="margin-left: 200px;padding-left: 200px;height:1200px;width:1000px;display: flex; justify-content:space-around;flex-wrap: wrap"
             float:left>
            <div id="main" style="height:65%;width:95%;justify-content:space-around;"></div>
        </div>
        <script type="text/javascript">
            $.ajax({
                url: "/match/getMatch",
                type: "GET",
                dataType: "JSON"
            }).then(function (response) {
                response_data = JSON.parse(response)
                debugger
                var chartDom = document.getElementById('main');
                var myChart = echarts.init(chartDom);
                var option;
                const hours = response_data.index
                const days = response_data.columns;
                // prettier-ignore
                const data = response_data.data

                    .map(function (item) {
                        console.log(item)
                        return [item[1], item[0], item[2] || '-'];
                    });
                option = {
                    tooltip: {
                        show:false,
                    },
                    grid: {
                        height: '50%',
                        top: '10%',
                        left: '28%'
                    },
                    xAxis: {
                        length: 60,
                        type: 'category',
                        data: hours,
                        splitArea: {
                            show: true
                        }
                    },
                    yAxis: {
                        length: 60,
                        type: 'category',
                        data: days,
                        splitArea: {
                            show: true
                        }
                    },
                    visualMap: {
                        min: 0,
                        max: 4,
                        calculable: true,
                        orient: 'horizontal',
                        left: 'center',
                        bottom: '20%'
                    },
                    series: [
                        {
                            type: 'heatmap',
                            data: data,
                           label: {
                                show: true,
                                formatter: function(params) {
                                    // 在这里可以自定义标签内容
                                    let s = params.value[2];
                                    let returnValue ="";
                                    if(s >=4){
                                        returnValue= "match!"
                                    }

                                    return returnValue;
                                }
                            },
                            emphasis: {
                                itemStyle: {
                                    shadowBlur: 20,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }
                    ]
                };
                option && myChart.setOption(option);
            })
        </script>
    </div>
    </body>
{% endblock %}